{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "%%bash\n",
    "mkdir -p logs\n",
    "TOP=${TOP:-$(git rev-parse --show-toplevel)}\n",
    "PATH=${TOP}/build/Examples/Cxx\n",
    "${PATH}/DAE_EMT_Slack_Resistor_RXLoad\n",
    "${PATH}/DAE_EMT_Slack_Resistor_RXLoadElements"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "# read Simulink log file\n",
    "\n",
    "import os\n",
    "print(os.getcwd())\n",
    "\n",
    "import matplotlib.pyplot as plt\n",
    "import villas.dataprocessing.readtools as rt\n",
    "\n",
    "# read EMT results\n",
    "log_name_RXLoad   = 'logs/DAE_EMT_Slack_Resistor_RXLoad_PF_Init/DAE_EMT_Slack_Resistor_RXLoad_PF_Init.csv'\n",
    "log_name_Elements = 'logs/DAE_EMT_Slack_Resistor_RXLoadElements/DAE_EMT_Slack_Resistor_RXLoadElements.csv'\n",
    "ts_dpsim_emt_RXLOAD = rt.read_timeseries_dpsim(log_name_RXLoad)\n",
    "ts_dpsim_emt_RXElements = rt.read_timeseries_dpsim(log_name_Elements)\n",
    "\n",
    "# Comparison\n",
    "\n",
    "#voltage v1 \n",
    "width = 12\n",
    "height = 3\n",
    "fig = plt.figure(figsize=(width, height))\n",
    "fig.suptitle('Error voltage node 1', fontsize=12)\n",
    "\n",
    "#phase A\n",
    "plt.subplot(1, 3, 1)\n",
    "v1A = ts_dpsim_emt_RXLOAD['v1_0'].values - ts_dpsim_emt_RXElements['v1_0'].values\n",
    "plt.plot(ts_dpsim_emt_RXLOAD['v1_0'].time, v1A, label='Phase A')\n",
    "plt.legend(loc='lower right')\n",
    "print(\"Big difference between voltages of node 1 of RXLoad and RXLoadElements phaseA: \"+str(max(v1A)))\n",
    "\n",
    "#voltage v1 phase B\n",
    "plt.subplot(1, 3, 2)\n",
    "v1B = ts_dpsim_emt_RXLOAD['v1_1'].values - ts_dpsim_emt_RXElements['v1_1'].values\n",
    "plt.plot(ts_dpsim_emt_RXLOAD['v1_1'].time, v1B, label='Phase B')\n",
    "plt.legend(loc='lower right')\n",
    "print(\"Big difference between voltages of node 1 of RXLoad and RXLoadElements phaseB: \"+str(max(v1B)))\n",
    "\n",
    "#voltage v1 phase C\n",
    "v1C = ts_dpsim_emt_RXLOAD['v1_2'].values - ts_dpsim_emt_RXElements['v1_2'].values\n",
    "plt.subplot(1, 3, 3)\n",
    "plt.plot(ts_dpsim_emt_RXLOAD['v1_2'].time, v1C, label='Phase C')\n",
    "plt.legend(loc='lower right')\n",
    "print(\"Big difference between voltages of node 1 of RXLoad and RXLoadElements phaseC: \"+str(max(v1C)))\n",
    "\n",
    "\n",
    "#voltage v2 \n",
    "width = 12\n",
    "height = 3\n",
    "fig2 = plt.figure(figsize=(width, height))\n",
    "fig2.suptitle('Error voltage node 2', fontsize=12)\n",
    "\n",
    "#phase A\n",
    "plt.subplot(1, 3, 1)\n",
    "v2A = ts_dpsim_emt_RXLOAD['v2_0'].values - ts_dpsim_emt_RXElements['v2_0'].values\n",
    "plt.plot(ts_dpsim_emt_RXLOAD['v2_0'].time, v2A, label='Phase A')\n",
    "plt.legend(loc='lower right')\n",
    "print(\"Big difference between voltages of node 2 of RXLoad and RXLoadElements phaseA: \"+str(max(v2A)))\n",
    "\n",
    "#voltage v2 phase B\n",
    "plt.subplot(1, 3, 2)\n",
    "v2B = ts_dpsim_emt_RXLOAD['v2_1'].values - ts_dpsim_emt_RXElements['v2_1'].values\n",
    "plt.plot(ts_dpsim_emt_RXLOAD['v2_1'].time, v2B, label='Phase B')\n",
    "plt.legend(loc='lower right')\n",
    "print(\"Big difference between voltages of node 2 of RXLoad and RXLoadElements phaseB: \"+str(max(v2B)))\n",
    "\n",
    "#voltage v2 phase C\n",
    "plt.subplot(1, 3, 3)\n",
    "v2C = ts_dpsim_emt_RXLOAD['v2_2'].values - ts_dpsim_emt_RXElements['v2_2'].values\n",
    "plt.plot(ts_dpsim_emt_RXLOAD['v2_2'].time, v2C, label='Phase C')\n",
    "plt.legend(loc='lower right')\n",
    "print(\"Big difference between voltages of node 2 of RXLoad and RXLoadElements phaseC: \"+str(max(v2C)))\n",
    "\n",
    "\n",
    "#currents \n",
    "width = 12\n",
    "height = 3\n",
    "fig3 = plt.figure(figsize=(width, height))\n",
    "fig3.suptitle('Error currents', fontsize=12)\n",
    "\n",
    "#current phase A\n",
    "plt.subplot(1, 3, 1)\n",
    "i = ts_dpsim_emt_RXLOAD['i_slack_0'].values - ts_dpsim_emt_RXElements['i_slack_0'].values\n",
    "plt.plot(ts_dpsim_emt_RXLOAD['i_slack_0'].time, i, label='Phase A')\n",
    "plt.legend(loc='lower right')\n",
    "print(\"Big difference between currents of RXLoad and RXLoadElements phaseA: \"+str(max(i)))\n",
    "\n",
    "#current phase B\n",
    "plt.subplot(1, 3, 2)\n",
    "i2 = ts_dpsim_emt_RXLOAD['i_slack_1'].values - ts_dpsim_emt_RXElements['i_slack_1'].values\n",
    "plt.plot(ts_dpsim_emt_RXLOAD['i_slack_1'].time, i2, label='Phase B')\n",
    "plt.legend(loc='lower right')\n",
    "print(\"Big difference between currents of RXLoad and RXLoadElements phaseB: \"+str(max(i2)))\n",
    "\n",
    "#current phase C\n",
    "plt.subplot(1, 3, 3)\n",
    "i3 = ts_dpsim_emt_RXLOAD['i_slack_2'].values - ts_dpsim_emt_RXElements['i_slack_2'].values\n",
    "plt.plot(ts_dpsim_emt_RXLOAD['i_slack_2'].time, i3, label='Phase C')\n",
    "plt.legend(loc='lower right')\n",
    "print(\"Big difference between currents of RXLoad and RXLoadElements phaseC: \"+str(max(i3)))\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
